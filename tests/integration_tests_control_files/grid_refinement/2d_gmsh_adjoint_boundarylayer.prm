# Listing of Parameters
# ---------------------
# Number of dimensions
set dimension = 2

# The PDE we want to solve. Choices are
# <advection|diffusion|convection_diffusion>.
set pde_type  = advection #convection_diffusion #      
set test_type = grid_refinement_study

subsection linear solver
#set linear_solver_type = direct
  subsection gmres options
    set linear_residual_tolerance = 1e-4
    set max_iterations = 2000
    set restart_number = 50
    set ilut_fill = 10
    # set ilut_drop = 1e-4
  end 
end

subsection ODE solver 
  # Maximum nonlinear solver iterations
  set nonlinear_max_iterations            = 500

  # Nonlinear solver residual tolerance
  set nonlinear_steady_residual_tolerance = 1e-12

  # Print every print_iteration_modulo iterations of the nonlinear solver
  set print_iteration_modulo              = 1

  # Explicit or implicit solverChoices are <explicit|implicit>.
  set ode_solver_type                     = implicit
end

subsection grid refinement study
  # polyonomial degrees
  set poly_degree      = 1
  set poly_degree_max  = 12 #4
  set poly_degree_grid = 1

  # grid setup
  set grid_type = read_grid
  set input_grid = output_bl15_adj_p1_5.msh
  
  # set grid_type  = hypercube

  #set input_grid = NaN
  set grid_left  = 0.0
  set grid_right = 1.0
  set grid_size  = 16

  # functional
  subsection functional
    # functional choice
    set functional_type = normLp_boundary

    # exponent
    set normLp = 2.0

    # boundaries to be used
    set boundary_vector = [1]
    set use_all_boundaries = false
  end

  # for the lpcvt runs
  subsection grid refinement
    set refinement_steps  = 1
    set refinement_method = continuous
    set refinement_type   = h

    set anisotropic = true
    set anisotropic_ratio_min = 0.2
    set anisotropic_ratio_max = 5.0

    set r_max = 20
	  set c_max = 4

    set error_indicator = adjoint_based
    set norm_Lq = 2.0
    # set complexity_vector = [256, 512, 1024, 2048, 4096, 8192, 16,384, 32768, 65536]
    # set complexity_vector = [576, 1152, 2304, 4608, 9216, 18432, 36864, 73728]
    # set complexity_vector = [2304, 3456, 5184, 7776, 11664, 17496, 26244, 39366, 59049]
    
    # p=1, 1.5x
    # set complexity_vector = [1024, 1536, 2304, 3456, 5184, 7776, 11664, 17496, 26244, 39366, 59049]

    # p=2, 1.5x
    # set complexity_vector = [2304, 3456, 5184, 7776, 11664, 17496, 26244, 39366, 59049, 88574]

    # p=3, 1.5x
    # set complexity_vector = [4096, 6144, 9216, 13824, 20736, 31104, 46656, 69984, 104976, 157464]

    
    set complexity_vector = [69984]

    set output_type = msh_out
    set output_data_type = metric_field    
  end

  # # for the alltogether run
  # set num_refinements = 3

  # # grid refinement
  # subsection grid refinement [2]
  #   set refinement_steps  = 8
  #   set refinement_method = continuous
  #   set refinement_type   = h
    
  #   #set anisotropic       = false
  #   set anisotropic       = true
  #   set anisotropic_ratio_min = 0.1
  #   set anisotropic_ratio_max = 10.0

  #   set error_indicator   = adjoint_based
  #   set norm_Lq           = 2.0
  #   # set complexity_scale  = 1.5001 # p = 1
  #   set complexity_scale  = 1.5
  #   set complexity_add    = 0.0

  # 	set r_max = 20
	#   set c_max = 4

  #   # output options
  #   set output_type      = gmsh_out
  # end

  # subsection grid refinement [3]
  #   set refinement_steps  = 6
  #   set refinement_method = continuous
  #   set refinement_type   = h
    
  #   #set anisotropic       = false
  #   set anisotropic       = true
  #   set anisotropic_ratio_min = 0.1
  #   set anisotropic_ratio_max = 10.0

  #   set error_indicator   = adjoint_based
  #   set norm_Lq           = 2.0
  #   set complexity_scale  = 2.0001 # p = 1
  #   set complexity_add    = 0.0

  # 	set r_max = 20
	#   set c_max = 4

  #   # output options
  #   set output_type      = gmsh_out
  # end

  # subsection grid refinement [0]
  #   set refinement_steps  = 4
  #   set refinement_method = uniform
  # end

  # subsection grid refinement [1]
  #   set refinement_steps  = 5
  #   set refinement_method = fixed_fraction

  #   set refinement_type     = h
  #   set anisotropic         = false
  #   set error_indicator     = adjoint_based
  #   set refinement_fraction = 0.3
  #   set coarsening_fraction = 0.00
  # end
end

subsection manufactured solution convergence study
  set use_manufactured_source_term = true
  set manufactured_solution_type   = boundary_layer_solution

  # setting the default diffusion tensor
  set diffusion_00 = 1
  set diffusion_01 = 0
  set diffusion_10 = 0
  set diffusion_11 = 1

  # setting the advection vector
  set advection_0 = 1
  set advection_1 = 1 

  # setting the diffusion coefficient
  set diffusion_coefficient = 0.1
  
end